-- Users Table
CREATE TABLE Users (
    UserID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR2(255),
    Email VARCHAR2(255) UNIQUE,
    PhoneNumber VARCHAR2(20),
    IsAdmin CHAR(1) CHECK (IsAdmin IN ('Y', 'N')),
    PasswordHash VARCHAR2(255)
);

-- Categories Table
CREATE TABLE Categories (
    CategoryID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR2(255) UNIQUE
);

-- Products Table
CREATE TABLE Products (
    ProductID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR2(255),
    Price DECIMAL(10,2),
    Description CLOB,
    CategoryID NUMBER,
    CONSTRAINT fk_Products_Categories FOREIGN KEY (CategoryID)
        REFERENCES Categories (CategoryID) ON DELETE SET NULL
);

-- Cart Table
CREATE TABLE Cart (
    CartID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    UserID NUMBER,
    CONSTRAINT fk_Cart_Users FOREIGN KEY (UserID)
        REFERENCES Users (UserID) ON DELETE CASCADE
);

-- CartItems Table
CREATE TABLE CartItems (
    CartItemID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CartID NUMBER,
    ProductID NUMBER,
    CONSTRAINT fk_CartItems_Cart FOREIGN KEY (CartID)
        REFERENCES Cart (CartID) ON DELETE CASCADE,
    CONSTRAINT fk_CartItems_Products FOREIGN KEY (ProductID)
        REFERENCES Products (ProductID) ON DELETE CASCADE
);

-- Orders Table
CREATE TABLE Orders (
    OrderID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    UserID NUMBER,
    TotalAmount DECIMAL(10,2),
    PaymentMethod VARCHAR2(255),
    CONSTRAINT fk_Orders_Users FOREIGN KEY (UserID)
        REFERENCES Users (UserID) ON DELETE CASCADE
);

-- Reviews Table
CREATE TABLE Reviews (
    ReviewID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    UserID NUMBER,
    ProductID NUMBER,
    Rating NUMBER CHECK (Rating BETWEEN 1 AND 5),
    Text CLOB,
    CONSTRAINT fk_Reviews_Users FOREIGN KEY (UserID)
        REFERENCES Users (UserID) ON DELETE CASCADE,
    CONSTRAINT fk_Reviews_Products FOREIGN KEY (ProductID)
        REFERENCES Products (ProductID) ON DELETE CASCADE
);

-- Coupons Table
CREATE TABLE Coupons (
    CouponID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Code VARCHAR2(255) UNIQUE,
    Discount DECIMAL(5,2),
    UserID NUMBER,
    CONSTRAINT fk_Coupons_Users FOREIGN KEY (UserID)
        REFERENCES Users (UserID) ON DELETE SET NULL
);